<!-- Phase stepper -->
<div class="flex items-center justify-center mb-6 space-x-4">
    {% with phase=run.progress_json.phase %}
    <!-- Preparing -->
    <div class="flex items-center space-x-2">
        <div class="w-3 h-3 rounded-full {% if phase == 'preparing' %}bg-indigo-500 animate-pulse{% elif phase == 'solving' or phase == 'extracting' or phase == 'done' %}bg-green-500{% else %}bg-gray-300{% endif %}"></div>
        <span class="text-sm {% if phase == 'preparing' %}font-semibold text-indigo-700{% elif phase == 'solving' or phase == 'extracting' or phase == 'done' %}text-green-700{% else %}text-gray-400{% endif %}">Preparing</span>
    </div>
    <div class="w-8 h-px {% if phase == 'solving' or phase == 'extracting' or phase == 'done' %}bg-green-300{% else %}bg-gray-300{% endif %}"></div>
    <!-- Solving -->
    <div class="flex items-center space-x-2">
        <div class="w-3 h-3 rounded-full {% if phase == 'solving' %}bg-indigo-500 animate-pulse{% elif phase == 'extracting' or phase == 'done' %}bg-green-500{% else %}bg-gray-300{% endif %}"></div>
        <span class="text-sm {% if phase == 'solving' %}font-semibold text-indigo-700{% elif phase == 'extracting' or phase == 'done' %}text-green-700{% else %}text-gray-400{% endif %}">Solving</span>
    </div>
    <div class="w-8 h-px {% if phase == 'extracting' or phase == 'done' %}bg-green-300{% else %}bg-gray-300{% endif %}"></div>
    <!-- Extracting Results -->
    <div class="flex items-center space-x-2">
        <div class="w-3 h-3 rounded-full {% if phase == 'extracting' %}bg-indigo-500 animate-pulse{% elif phase == 'done' %}bg-green-500{% else %}bg-gray-300{% endif %}"></div>
        <span class="text-sm {% if phase == 'extracting' %}font-semibold text-indigo-700{% elif phase == 'done' %}text-green-700{% else %}text-gray-400{% endif %}">Extracting Results</span>
    </div>
    {% endwith %}
</div>

<!-- Status-specific display -->
{% if run.status == "completed" %}
<div class="mb-4">
    <div class="w-full bg-gray-200 rounded-full h-3">
        <div class="h-3 rounded-full bg-green-600 w-full"></div>
    </div>
    <p class="text-sm font-medium text-green-700 mt-2 text-center">Completed</p>
</div>

{% elif run.status == "failed" %}
<div class="mb-4">
    <div class="w-full bg-gray-200 rounded-full h-3">
        <div class="h-3 rounded-full bg-red-600 w-full"></div>
    </div>
    <p class="text-sm font-medium text-red-700 mt-2 text-center">Failed</p>
</div>

{% elif run.status == "cancelled" %}
<div class="mb-4">
    <div class="w-full bg-gray-200 rounded-full h-3">
        <div class="h-3 rounded-full bg-yellow-500 w-full"></div>
    </div>
    <p class="text-sm font-medium text-yellow-700 mt-2 text-center">Cancelled</p>
</div>

{% else %}
<!-- Running / Pending â€” indeterminate bar -->
<div class="mb-4">
    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
        <div class="h-3 rounded-full bg-indigo-600 indeterminate-bar"></div>
    </div>
    <p class="text-sm font-medium text-indigo-700 mt-2 text-center">
        {% if run.status == "running" %}Running...{% else %}Pending...{% endif %}
    </p>
</div>

<!-- Real-time stats during solving -->
{% if run.progress_json.phase == "solving" and run.progress_json.solutions_found is not None %}
<div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-4">
    <div class="bg-gray-50 rounded-lg p-3 text-center">
        <div class="text-xs text-gray-500 uppercase tracking-wider">Elapsed</div>
        <div class="text-lg font-semibold text-gray-900 mt-1">{{ run.progress_json.wall_time|default:"--" }}s</div>
    </div>
    <div class="bg-gray-50 rounded-lg p-3 text-center">
        <div class="text-xs text-gray-500 uppercase tracking-wider">Solutions</div>
        <div class="text-lg font-semibold text-gray-900 mt-1">{{ run.progress_json.solutions_found }}</div>
    </div>
    <div class="bg-gray-50 rounded-lg p-3 text-center">
        <div class="text-xs text-gray-500 uppercase tracking-wider">Objective</div>
        <div class="text-lg font-semibold text-gray-900 mt-1">{{ run.progress_json.objective_value|default:"--" }}</div>
    </div>
    <div class="bg-gray-50 rounded-lg p-3 text-center">
        <div class="text-xs text-gray-500 uppercase tracking-wider">Gap</div>
        <div class="text-lg font-semibold text-gray-900 mt-1">{{ run.progress_json.gap_percent|default:"--" }}%</div>
    </div>
</div>
{% endif %}
{% endif %}

{% if run.started_at %}
<p class="text-sm text-gray-500 mt-4 text-center">
    Started: {{ run.started_at|date:"N j, Y g:i A" }}
</p>
{% endif %}
